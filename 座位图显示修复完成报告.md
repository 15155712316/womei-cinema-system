# ğŸ­ åº§ä½å›¾æ˜¾ç¤ºä¿®å¤å®ŒæˆæŠ¥å‘Š

## ğŸ¯ é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆï¼š**"åº§ä½å‚æ•°æ˜¯æˆåŠŸè·å–äº† ä½†æ˜¯å¹¶æ²¡æœ‰çœŸæ­£å±•ç¤ºå‡ºæ¥ æŒ‰ç…§ä¹‹å‰çš„æ–¹å¼å±•ç¤ºå‡ºæ¥"**

**é—®é¢˜ç°è±¡**ï¼š
- åº§ä½å›¾APIæˆåŠŸè¿”å›æ•°æ®ï¼Œä½†åº§ä½å›¾ä¸æ˜¾ç¤º
- åŸå§‹çš„åº§ä½å›¾è§£æé€»è¾‘ä¸æ–°APIæ•°æ®æ ¼å¼ä¸åŒ¹é…
- åº§ä½å›¾é¢æ¿ç»„ä»¶çš„å­—æ®µè®¿é—®æ–¹å¼è¿‡æ—¶

## ğŸ” é—®é¢˜åˆ†æ

### æ ¹æœ¬åŸå› 
1. **æ•°æ®æ ¼å¼ä¸åŒ¹é…**ï¼šä¸»ç¨‹åºæœŸæœ›çš„æ•°æ®æ ¼å¼ä¸å®é™…APIè¿”å›æ ¼å¼ä¸ä¸€è‡´
   - æœŸæœ›æ ¼å¼ï¼š`seatPlanStr` å­—ç¬¦ä¸² + `seatRowCount/seatColCount` 
   - å®é™…æ ¼å¼ï¼š`seats` æ•°ç»„ + `hname/screentype/seatcount`

2. **è§£æé€»è¾‘é”™è¯¯**ï¼šåº§ä½å­—ç¬¦ä¸²è§£ææ–¹æ³•æ— æ³•å¤„ç†seatsæ•°ç»„æ•°æ®

3. **å­—æ®µæ˜ å°„é”™è¯¯**ï¼šåº§ä½é¢æ¿ç»„ä»¶ä½¿ç”¨äº†é”™è¯¯çš„å­—æ®µå
   - ä½¿ç”¨ `cn` å­—æ®µè·å–åˆ—å·ï¼Œå®é™…åº”è¯¥æ˜¯ `col`
   - ä½¿ç”¨ `s` å­—æ®µåˆ¤æ–­çŠ¶æ€ï¼Œå®é™…åº”è¯¥æ˜¯ `state`

### æ•°æ®æµå¯¹æ¯”

**ä¿®å¤å‰ï¼ˆé”™è¯¯çš„æµç¨‹ï¼‰**ï¼š
```
APIè¿”å›seatsæ•°ç»„ â†’ å¯»æ‰¾seatPlanStrå­—ç¬¦ä¸² â†’ è§£æå¤±è´¥ â†’ åº§ä½å›¾ä¸æ˜¾ç¤º
```

**ä¿®å¤åï¼ˆæ­£ç¡®çš„æµç¨‹ï¼‰**ï¼š
```
APIè¿”å›seatsæ•°ç»„ â†’ è§£æseatsæ•°ç»„ â†’ æ„å»ºåº§ä½çŸ©é˜µ â†’ ä¼ é€’ç»™é¢æ¿ç»„ä»¶ â†’ æ­£ç¡®æ˜¾ç¤º
```

## ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤1: ä¸»ç¨‹åºåº§ä½æ•°æ®è§£æé‡æ„
**æ–‡ä»¶**: `main_modular.py`
**æ–¹æ³•**: `_display_seat_map()` + `_parse_seats_array()`

```python
# ğŸ†• ä¿®æ”¹å‰ï¼šé”™è¯¯çš„æ•°æ®æ ¼å¼å‡è®¾
hall_info = {
    'name': seat_data.get('hallName', 'æœªçŸ¥å½±å…'),  # âŒ é”™è¯¯å­—æ®µ
    'rows': seat_data.get('seatRowCount', 0),      # âŒ é”™è¯¯å­—æ®µ
    'cols': seat_data.get('seatColCount', 0),      # âŒ é”™è¯¯å­—æ®µ
}
seat_str = seat_data.get('seatPlanStr', '')       # âŒ é”™è¯¯å­—æ®µ

# ğŸ†• ä¿®æ”¹åï¼šæ­£ç¡®çš„APIæ•°æ®æ ¼å¼
hall_info = {
    'name': seat_data.get('hname', 'æœªçŸ¥å½±å…'),    # âœ… æ­£ç¡®å­—æ®µ
    'screen_type': seat_data.get('screentype', ''),# âœ… æ–°å¢å­—æ®µ
    'seat_count': seat_data.get('seatcount', 0)    # âœ… æ­£ç¡®å­—æ®µ
}
seats_array = seat_data.get('seats', [])          # âœ… æ­£ç¡®æ•°æ®ç»“æ„
```

**æ ¸å¿ƒæ”¹è¿›**ï¼š
- æ–°å¢ `_parse_seats_array()` æ–¹æ³•ï¼Œä¸“é—¨å¤„ç†seatsæ•°ç»„æ•°æ®
- åŠ¨æ€åˆ†æåº§ä½åˆ†å¸ƒï¼Œç¡®å®šè¡Œåˆ—çŸ©é˜µå°ºå¯¸
- æ­£ç¡®è§£æseatå¯¹è±¡çš„ `rownum`, `colnum`, `state`, `seatname` ç­‰å­—æ®µ
- æ„å»ºæ ‡å‡†åŒ–çš„åº§ä½çŸ©é˜µæ•°æ®ç»“æ„

### ä¿®å¤2: åº§ä½é¢æ¿ç»„ä»¶å­—æ®µé€‚é…
**æ–‡ä»¶**: `ui/components/seat_map_panel_pyqt5.py`
**æ–¹æ³•**: `_draw_seats()`, `update_display()`, `toggle_seat()`, `clear_selection()`

```python
# ğŸ†• ä¿®å¤åˆ—å·è·å–
col_num = seat.get('col', c+1)  # ä½¿ç”¨colå­—æ®µè€Œécn

# ğŸ†• ä¿®å¤åº§ä½ç¼–å·æ˜¾ç¤º
num_text = seat.get('seatname', '') or seat.get('num', '')
if not num_text:
    row = seat.get('row', self.row + 1)
    col = seat.get('col', self.col + 1)
    num_text = f"{row}-{col}"

# ğŸ†• ä¿®å¤çŠ¶æ€æ¢å¤é€»è¾‘
original_data = seat.get('original_data', {})
original_state = original_data.get('state', 0)
if original_state == 1:
    seat['status'] = 'sold'
elif original_state == 2:
    seat['status'] = 'unavailable'
else:
    seat['status'] = 'available'
```

**æ ¸å¿ƒæ”¹è¿›**ï¼š
- ä¿®å¤å­—æ®µåæ˜ å°„ï¼ˆ`cn` â†’ `col`, `s` â†’ `state`ï¼‰
- å¢å¼ºåº§ä½ç¼–å·æ˜¾ç¤ºé€»è¾‘ï¼ˆä¼˜å…ˆä½¿ç”¨ `seatname`ï¼‰
- ä¿®å¤çŠ¶æ€åˆ‡æ¢å’Œæ¢å¤é€»è¾‘ï¼Œä½¿ç”¨åŸå§‹APIæ•°æ®

### ä¿®å¤3: æ•°æ®ç»“æ„æ ‡å‡†åŒ–
**æ–°çš„åº§ä½æ•°æ®æ ¼å¼**ï¼š
```python
seat_data = {
    'row': seat.get('rownum', row_num + 1),        # è¡Œå·
    'col': seat.get('colnum', col_num + 1),        # åˆ—å·  
    'num': f"{rownum}æ’{colnum}åº§",                 # æ˜¾ç¤ºåç§°
    'status': status,                               # çŠ¶æ€(available/sold/unavailable)
    'price': seat.get('price', 0),                  # ä»·æ ¼
    'seatname': seat.get('seatname', ''),          # APIåŸå§‹åç§°
    'original_data': seat                           # ä¿å­˜åŸå§‹APIæ•°æ®
}
```

## ğŸ§ª éªŒè¯ä¸æµ‹è¯•

### æµ‹è¯•ç¯å¢ƒ
- **æµ‹è¯•è„šæœ¬**: `test_seat_display_fix.py`
- **æ¨¡æ‹Ÿæ•°æ®**: åŒ…å«8ä¸ªåº§ä½ï¼ˆ2è¡Œx4åˆ—ï¼‰ï¼ŒåŒ…æ‹¬å·²å”®ã€ä¸å¯ç”¨çŠ¶æ€

### æµ‹è¯•ç»“æœ
```
âœ… è§£æå®Œæˆ: 2 è¡Œåº§ä½çŸ©é˜µ
ç¬¬1è¡Œ: â—‹â—‹â—â—‹  (å¯é€‰ã€å¯é€‰ã€å·²å”®ã€å¯é€‰)
ç¬¬2è¡Œ: â—‹â—‹â—‹âœ—  (å¯é€‰ã€å¯é€‰ã€å¯é€‰ã€ä¸å¯ç”¨)

åº§ä½ç»Ÿè®¡:
  æ€»åº§ä½: 8
  å¯é€‰: 6
  å·²å”®: 1  
  ä¸å¯ç”¨: 1
```

### åŠŸèƒ½éªŒè¯
- âœ… **åº§ä½çŸ©é˜µæ„å»º**: seatsæ•°ç»„æ­£ç¡®è§£æä¸ºè¡Œåˆ—çŸ©é˜µ
- âœ… **çŠ¶æ€è§£æ**: stateå­—æ®µæ­£ç¡®æ˜ å°„ä¸ºstatusçŠ¶æ€
- âœ… **åº§ä½ç¼–å·**: seatnameå­—æ®µæ­£ç¡®æ˜¾ç¤º
- âœ… **äº¤äº’åŠŸèƒ½**: åº§ä½é€‰æ‹©/å–æ¶ˆé€‰æ‹©æ­£å¸¸å·¥ä½œ
- âœ… **çŠ¶æ€æ¢å¤**: å–æ¶ˆé€‰æ‹©æ—¶æ­£ç¡®æ¢å¤åŸå§‹çŠ¶æ€

## ğŸ“Š ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰
```
[ä¸»çª—å£] åº§ä½æ•°æ®å­—æ®µ: ['hname', 'screentype', 'seatcount', 'seats']
[ä¸»çª—å£] æœªæ‰¾åˆ°åº§ä½å¸ƒå±€æ•°æ®
[ä¸»çª—å£] åº§ä½çŸ©é˜µæ•°æ®æ— æ•ˆ
```

### ä¿®å¤å  
```
[ä¸»çª—å£] åº§ä½æ•°æ®å­—æ®µ: ['hname', 'screentype', 'seatcount', 'seats']
[ä¸»çª—å£] å¼€å§‹è§£æseatsæ•°ç»„
[ä¸»çª—å£] åº§ä½çŸ©é˜µå°ºå¯¸: 2è¡Œ x 4åˆ—
[ä¸»çª—å£] åº§ä½çŸ©é˜µè§£æå®Œæˆ: 2 è¡Œ
[ä¸»çª—å£] åº§ä½å›¾é¢æ¿åˆ›å»ºæˆåŠŸ
```

## ğŸ æœ€ç»ˆçŠ¶æ€

### âœ… ä¿®å¤å®Œæˆç¡®è®¤
- **APIæ•°æ®è·å–**: âœ… æˆåŠŸï¼ˆbase_urlä¼ é€’ä¿®å¤ï¼‰
- **æ•°æ®è§£æ**: âœ… æˆåŠŸï¼ˆseatsæ•°ç»„è§£æï¼‰
- **åº§ä½å›¾æ˜¾ç¤º**: âœ… æˆåŠŸï¼ˆé¢æ¿ç»„ä»¶é€‚é…ï¼‰
- **äº¤äº’åŠŸèƒ½**: âœ… æˆåŠŸï¼ˆé€‰åº§/å–æ¶ˆåŠŸèƒ½ï¼‰

### ğŸš€ ä½¿ç”¨è¯´æ˜
1. **å¯åŠ¨ç³»ç»Ÿ**: åŒå‡» `å¯åŠ¨æ¨¡å—åŒ–ç³»ç»Ÿ-ä¿®å¤ç‰ˆ.bat` æˆ–è¿è¡Œ `python main_modular.py`
2. **é€‰æ‹©å½±é™¢**: ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ªå½±é™¢
3. **é€‰æ‹©å½±ç‰‡**: ä»ä¸‹æ‹‰åˆ—è¡¨é€‰æ‹©å½±ç‰‡
4. **é€‰æ‹©æ—¥æœŸ**: ä»æ—¥æœŸåˆ—è¡¨é€‰æ‹©æ”¾æ˜ æ—¥æœŸ
5. **é€‰æ‹©åœºæ¬¡**: ä»åœºæ¬¡ä¸‹æ‹‰åˆ—è¡¨é€‰æ‹©å…·ä½“åœºæ¬¡
6. **æŸ¥çœ‹åº§ä½å›¾**: åº§ä½å›¾å°†è‡ªåŠ¨åŠ è½½å¹¶æ˜¾ç¤ºåœ¨ç•Œé¢ä¸‹æ–¹
7. **é€‰æ‹©åº§ä½**: ç‚¹å‡»ç»¿è‰²å¯é€‰åº§ä½è¿›è¡Œé€‰æ‹©
8. **æäº¤è®¢å•**: é€‰æ‹©å®Œåº§ä½åç‚¹å‡»"æäº¤è®¢å•"æŒ‰é’®

### ğŸ“ ç›¸å…³æ–‡ä»¶
- **ä¸»ç¨‹åº**: `main_modular.py` (åº§ä½æ•°æ®è§£æé€»è¾‘)
- **åº§ä½ç»„ä»¶**: `ui/components/seat_map_panel_pyqt5.py` (æ˜¾ç¤ºç»„ä»¶)
- **æµ‹è¯•è„šæœ¬**: `test_seat_display_fix.py` (éªŒè¯è„šæœ¬)
- **å¯åŠ¨è„šæœ¬**: `å¯åŠ¨æ¨¡å—åŒ–ç³»ç»Ÿ-ä¿®å¤ç‰ˆ.bat` (æ¨èå¯åŠ¨æ–¹å¼)

### ğŸ”— å…³è”ä¿®å¤
æœ¬æ¬¡ä¿®å¤åŸºäºä¹‹å‰çš„ **base_urlä¼ é€’ä¿®å¤** æˆæœï¼Œå½¢æˆå®Œæ•´çš„åº§ä½å›¾åŠŸèƒ½é“¾è·¯ï¼š
1. **æ•°æ®è·å–** (base_urlä¿®å¤) â†’ **æ•°æ®è§£æ** (æœ¬æ¬¡ä¿®å¤) â†’ **æ•°æ®æ˜¾ç¤º** (æœ¬æ¬¡ä¿®å¤)

---

## ğŸ“‹ æŠ€æœ¯è¯´æ˜

### APIæ•°æ®æ ¼å¼ç¤ºä¾‹
```json
{
    "hname": "1å·å…",
    "screentype": "IMAX", 
    "seatcount": 150,
    "seats": [
        {
            "rownum": 1,
            "colnum": 1, 
            "seatname": "1-1",
            "state": 0,
            "price": 45
        }
    ]
}
```

### çŠ¶æ€æ˜ å°„è§„åˆ™
- `state: 0` â†’ `status: 'available'` (ç»¿è‰²ï¼Œå¯é€‰)
- `state: 1` â†’ `status: 'sold'` (ç°è‰²ï¼Œå·²å”®)  
- `state: 2` â†’ `status: 'unavailable'` (ç°è‰²å¸¦å‰ï¼Œä¸å¯ç”¨)
- é€‰ä¸­å â†’ `status: 'selected'` (äº®ç»¿è‰²ï¼Œå·²é€‰ä¸­)

---

**ğŸ‰ åº§ä½å›¾æ˜¾ç¤ºåŠŸèƒ½ä¿®å¤å®Œæˆï¼ç”¨æˆ·ç°åœ¨å¯ä»¥æ­£å¸¸çœ‹åˆ°å¹¶æ“ä½œåº§ä½å›¾äº†ã€‚** 