# 模拟影院下单系统开发文档

## 一、项目概述
本项目为"模拟影院下单系统"，采用 Python 3.8+ 及 Tkinter/ttkbootstrap 实现桌面端美观、易用的购票体验。系统支持账号管理、影院与影片选择、座位可视化选购、下单与支付、订单管理等功能，所有数据均本地 JSON 文件模拟，适合初学者学习和演示。

## 二、项目结构
```
cinema_order_simulator/
├── main.py                # 程序入口
├── ui/                    # 界面相关代码
│   ├── main_window.py     # 主界面UI（Tkinter实现）
│   ├── cinema_select_panel.py # 影院/影片/场次选择区
│   ├── seat_map_panel.py      # 座位图选择区
│   ├── account_panel.py       # 账号信息区
│   ├── account_list_panel.py  # 账号列表区
│   └── login_panel.py         # 登录面板
├── models/                # 数据模型
│   ├── account.py         # 账号模型
│   ├── cinema.py          # 影院模型
│   ├── movie.py           # 电影模型
│   ├── order.py           # 订单模型
├── services/              # 业务逻辑
│   ├── film_service.py    # 影片与场次服务
│   ├── order_service.py   # 下单相关逻辑
│   ├── payment_service.py # 支付相关逻辑
├── data/                  # 本地数据存储
│   ├── accounts.json      # 账号数据
│   ├── cinemas.json       # 影院数据
│   ├── movies.json        # 电影数据
│   └── orders.json        # 订单数据
└── README.md              # 项目说明文档
```

## 三、技术选型
- 前端/桌面UI：Tkinter + ttkbootstrap
- 后端/数据：本地JSON文件模拟，无需数据库
- 开发语言：Python 3.8+
- 推荐IDE：VS Code / PyCharm

## 四、主要功能
1. 账号管理：导入/登录账号，显示余额、积分等。
2. 影院与影片选择：支持城市、影院、影片、场次多级筛选。
3. 选座购票：可视化座位图，支持多选座位。
4. 下单与支付：生成订单，模拟扫码支付或一键支付。
5. 出票与取票：支付后显示出票二维码和取票码。
6. 会员卡与优惠：支持会员卡、积分、优惠券等。
7. 订单管理：订单查询、复制、取消等。

## 五、主要数据结构样例

### 5.1 账号（account）
```json
{
  "id": "user001",
  "name": "张三",
  "balance": 100.0,
  "points": 200
}
```

### 5.2 影院（cinema）
```json
{
  "id": "cinema001",
  "name": "乐影国际影城",
  "city": "上海"
}
```

### 5.3 电影（movie）
```json
{
  "id": "movie001",
  "title": "流浪地球2",
  "duration": 130
}
```

### 5.4 场次（session）
```json
{
  "id": "session001",
  "cinema_id": "cinema001",
  "movie_id": "movie001",
  "date": "2024-06-01",
  "time": "19:30",
  "hall": "1号厅",
  "price": 45.0
}
```

### 5.5 座位（seat）
```json
{
  "row": 5,
  "col": 8,
  "status": "available"  // available, sold, selected
}
```

### 5.6 订单（order）
```json
{
  "id": "order001",
  "account_id": "user001",
  "session_id": "session001",
  "seats": [{"row":5,"col":8}],
  "total_price": 45.0,
  "status": "paid"  // unpaid, paid, cancelled
}
```

## 六、接口说明

### 6.1 账号相关
| 接口名         | 功能         | 输入参数           | 输出参数         | 说明           |
| -------------- | ------------ | ------------------ | --------------- | -------------- |
| login          | 账号登录     | 账号、密码         | 登录结果、信息   | 本地校验       |
| get_accounts   | 获取账号列表 | 无                 | 账号列表        | 读取本地数据   |
| get_balance    | 查询余额     | 账号ID             | 余额、积分      |                |

### 6.2 影院与影片
| 接口名         | 功能         | 输入参数           | 输出参数         | 说明           |
| -------------- | ------------ | ------------------ | --------------- | -------------- |
| get_cities     | 获取城市列表 | 无                 | 城市列表        |                |
| get_cinemas    | 获取影院列表 | 城市名             | 影院列表        |                |
| get_movies     | 获取影片列表 | 影院ID             | 影片列表        |                |
| get_sessions   | 获取场次     | 影院ID、影片ID     | 场次列表        |                |

### 6.3 选座与下单
| 接口名         | 功能         | 输入参数           | 输出参数         | 说明           |
| -------------- | ------------ | ------------------ | --------------- | -------------- |
| get_seats      | 获取座位图   | 场次ID             | 座位分布        |                |
| create_order   | 创建订单     | 账号ID、场次ID、座位 | 订单信息        |                |
| pay_order      | 支付订单     | 订单ID、支付方式   | 支付结果        | 模拟支付       |
| get_order      | 查询订单     | 订单ID             | 订单详情        |                |
| cancel_order   | 取消订单     | 订单ID             | 取消结果        |                |

### 6.4 会员卡与优惠
| 接口名         | 功能         | 输入参数           | 输出参数         | 说明           |
| -------------- | ------------ | ------------------ | --------------- | -------------- |
| get_coupons    | 获取优惠券   | 账号ID             | 优惠券列表      |                |
| use_coupon     | 使用优惠券   | 订单ID、优惠券ID   | 使用结果        |                |

## 七、交互流程与界面原型

### 7.1 交互流程
1. 登录/导入账号
2. 选择城市 → 选择影院 → 选择影片 → 选择场次
3. 选座（点击座位图）
4. 生成订单 → 显示订单详情
5. 扫码支付/一键支付（模拟）
6. 出票，显示二维码和取票码
7. 订单管理（可取消、复制、查看历史）

### 7.2 关键界面原型（文字版）
- 账号管理区（左侧）：账号输入、登录、账号列表、余额、积分
- 影院/影片/场次/座位选择区（中间）：多级下拉框、座位图（可点击）
- 订单详情区（右侧）：订单信息、支付二维码、出票二维码、订单操作

## 八、开发状态跟踪
| 模块/功能        | 状态     | 负责人 | 计划完成日期 | 实际完成日期 | 备注与链接 |
|------------------|----------|--------|--------------|--------------|------------|
| 账号管理         | 已完成   | AI     | 2024-06-01   | 2024-06-01   |            |
| 影院/影片选择    | 已完成   | AI     | 2024-06-01   | 2024-06-01   |            |
| 场次与座位联动   | 已完成   | AI     | 2024-06-02   | 2024-06-02   |            |
| 下单与支付       | 进行中   | AI     | 2024-06-03   |              |            |
| 订单管理         | 未开始   | AI     | 2024-06-04   |              |            |
| 优惠与会员       | 未开始   | AI     | 2024-06-05   |              |            |

## 九、技术实现细节
- Tkinter/ttkbootstrap 美化：控件统一风格、圆角、字体、间距、按钮高亮优化，详见 ui/main_window.py。
- 三级联动：影片、日期、场次下拉框联动，数据结构 films/shows，详见 ui/cinema_select_panel.py。
- 数据解析：本地 JSON 文件读取，处理 UTF-8 BOM，详见 services/film_service.py。
- 详细注释：所有核心函数、控件均有详细注释，便于调试和维护。
- 兼容性：已针对 Windows 下 Tkinter focus ring 做兼容处理。

## 十、代码检查与问题记录
- [2024-06-01] 发现座位图溢出问题，已通过 grid+sticky 优化自适应。
- [2024-06-02] 三级联动初版完成，控件样式统一。
- [2024-06-03] 需进一步优化支付流程与订单状态管理。

## 十一、环境配置与运行指南
1. 安装 Python 3.8 及以上版本。
2. 安装依赖库：
   ```bash
   pip install ttkbootstrap
   ```
3. 运行主程序：
   ```bash
   python main.py
   ```
4. 所有数据均为本地 JSON 文件，无需数据库。

---
如需更详细的接口参数示例、json格式样例、UI原型图手绘版等，可随时补充！ 