# main_modular.py å››ä¸ªé—®é¢˜ä¿®å¤æ€»ç»“æŠ¥å‘Š

## ğŸ“‹ ä¿®å¤æ¦‚è¿°

æ ¹æ®ç”¨æˆ·åé¦ˆï¼Œå¯¹ `main_modular.py` æ–‡ä»¶è¿›è¡Œäº†å››ä¸ªå…·ä½“é—®é¢˜çš„æ’æŸ¥å’Œä¿®å¤ï¼Œç¡®ä¿æ‰€æœ‰åŠŸèƒ½ä¸ç°æœ‰çš„ä¼šå‘˜å¡å¯†ç ç­–ç•¥æ£€æµ‹åŠŸèƒ½ä¿æŒä¸€è‡´ã€‚

## ğŸ”§ é—®é¢˜ä¿®å¤è¯¦æƒ…

### 1. âœ… ç§»é™¤å¿«é€Ÿç™»å½•åŠŸèƒ½

#### é—®é¢˜æè¿°
- å‡ºç°äº†ä¸éœ€è¦çš„å¿«é€Ÿç™»å½•åŠŸèƒ½
- åŒå‡»è´¦å·ä¼šå¼¹å‡º"å‡†å¤‡å¿«é€Ÿç™»å½•è´¦å·"æç¤º

#### ä¿®å¤å†…å®¹
**æ–‡ä»¶**: `ui/widgets/account_widget.py`

```python
# ä¿®å¤å‰
self.account_table.cellDoubleClicked.connect(self._on_account_double_clicked)

def _on_account_double_clicked(self, row: int, column: int):
    # å¿«é€Ÿç™»å½•é€»è¾‘...

# ä¿®å¤å
# ğŸ†• ç§»é™¤åŒå‡»äº‹ä»¶ï¼Œé¿å…å¿«é€Ÿç™»å½•åŠŸèƒ½
# å®Œå…¨åˆ é™¤ _on_account_double_clicked æ–¹æ³•
```

#### ä¿®å¤æ•ˆæœ
- âœ… åŒå‡»è´¦å·ä¸å†è§¦å‘ä»»ä½•æ“ä½œ
- âœ… ç•Œé¢æ›´åŠ ç®€æ´ï¼Œæ— ä¸å¿…è¦çš„æç¤º
- âœ… ç”¨æˆ·ä½“éªŒæ›´åŠ ä¸“ä¸š

### 2. âœ… ä¿®å¤ä¼šå‘˜ä»·æ˜¾ç¤ºé—®é¢˜

#### é—®é¢˜æè¿°
- ä¸‹å•æ—¶æ˜¾ç¤ºçš„ä¸æ˜¯ä¼šå‘˜ä»·æ ¼ï¼Œè€Œæ˜¯åŸä»·
- å½“å‰æ˜¾ç¤ºï¼šåŸä»· Â¥33.90ï¼Œå®ä»˜é‡‘é¢ Â¥33.90
- æœŸæœ›æ˜¾ç¤ºï¼šåº”è¯¥æ˜¾ç¤ºä¼šå‘˜ä¼˜æƒ ä»·æ ¼

#### ä¿®å¤å†…å®¹
**æ–‡ä»¶**: `main_modular.py`

```python
# ğŸ†• åœ¨è®¢å•åˆ›å»ºåç«‹å³è·å–è®¢å•è¯¦æƒ…
from services.order_api import get_order_detail
order_detail_result = get_order_detail(detail_params)

# ğŸ†• ä»è®¢å•è¯¦æƒ…ä¸­è·å–ä¼šå‘˜ä»·æ ¼
member_total_price = 0
if order_detail_result and order_detail_result.get('resultCode') == '0':
    detail_data = order_detail_result.get('resultData', {})
    member_total_price = int(detail_data.get('mem_totalprice', '0'))

# ğŸ†• ä¿å­˜ä¼šå‘˜ä»·æ ¼åˆ°è®¢å•æ•°æ®
self.current_order = {
    # ... å…¶ä»–å­—æ®µ
    'mem_totalprice': member_total_price,  # æ·»åŠ ä¼šå‘˜ä»·æ ¼
    'api_data': order_detail_result.get('resultData', {})
}

# ğŸ†• æ˜¾ç¤ºæ—¶ä¼˜å…ˆä½¿ç”¨ä¼šå‘˜ä»·æ ¼
member_price = order_detail.get('mem_totalprice', 0)
if member_price > 0:
    member_amount = member_price / 100.0
    info_lines.append(f"å®ä»˜é‡‘é¢: Â¥{member_amount:.2f} (ä¼šå‘˜ä»·)")
else:
    info_lines.append(f"å®ä»˜é‡‘é¢: Â¥{amount:.2f}")
```

#### ä¿®å¤æ•ˆæœ
- âœ… è®¢å•åˆ›å»ºåè‡ªåŠ¨è·å–ä¼šå‘˜ä»·æ ¼
- âœ… è®¢å•è¯¦æƒ…ä¼˜å…ˆæ˜¾ç¤ºä¼šå‘˜ä¼˜æƒ ä»·
- âœ… ä»·æ ¼æ˜¾ç¤ºæ›´åŠ å‡†ç¡®å’Œé€æ˜

### 3. âœ… ä¿®å¤å¯†ç ç­–ç•¥æ˜¾ç¤ºç¼ºå¤±

#### é—®é¢˜æè¿°
- è®¢å•è¯¦æƒ…ä¸­æ²¡æœ‰æ˜¾ç¤º"å¯†ç : éœ€è¦è¾“å…¥"ç­‰å¯†ç ç­–ç•¥ä¿¡æ¯
- æµ‹è¯•è®¢å•ï¼š202506061158566613245ï¼Œå½±é™¢ä¸ºåå¤ä¼˜åŠ èŸå¤§éƒ½èŸ

#### ä¿®å¤å†…å®¹
**æ–‡ä»¶**: `main_modular.py`

```python
# ğŸ†• å¯†ç ç­–ç•¥ä¿¡æ¯ - ä¿®å¤æ˜¾ç¤ºé€»è¾‘
enable_mempassword = None

# æ–¹æ³•1: ä»api_dataè·å–
api_data = order_detail.get('api_data', {})
if api_data and isinstance(api_data, dict):
    enable_mempassword = api_data.get('enable_mempassword')

# æ–¹æ³•2: ç›´æ¥ä»order_detailè·å–
if enable_mempassword is None:
    enable_mempassword = order_detail.get('enable_mempassword')

# æ˜¾ç¤ºå¯†ç ç­–ç•¥
if enable_mempassword == '1':
    info_lines.append("å¯†ç : éœ€è¦è¾“å…¥")
elif enable_mempassword == '0':
    info_lines.append("å¯†ç : æ— éœ€è¾“å…¥")
else:
    # ä»å®ä¾‹çŠ¶æ€è·å–æˆ–æ˜¾ç¤ºæ£€æµ‹ä¸­
    if hasattr(self, 'member_password_policy') and self.member_password_policy:
        requires_password = self.member_password_policy.get('requires_password', True)
        info_lines.append(f"å¯†ç : {'éœ€è¦è¾“å…¥' if requires_password else 'æ— éœ€è¾“å…¥'}")
    else:
        info_lines.append("å¯†ç : æ£€æµ‹ä¸­...")
```

#### ä¿®å¤æ•ˆæœ
- âœ… è®¢å•è¯¦æƒ…æ­£ç¡®æ˜¾ç¤ºå¯†ç ç­–ç•¥
- âœ… æ”¯æŒå¤šç§æ•°æ®æºè·å–ç­–ç•¥
- âœ… ä¸æ”¯ä»˜æ—¶çš„å¯†ç æ£€æµ‹ä¿æŒä¸€è‡´

### 4. âœ… ä¿®å¤è´¦å·åˆ—è¡¨å³é”®èœå•æ— å“åº”

#### é—®é¢˜æè¿°
- è´¦å·åˆ—è¡¨å³é”®ç‚¹å‡»æ— ååº”
- æœŸæœ›è¡Œä¸ºï¼šå³é”®åº”è¯¥æ˜¾ç¤ºä¸Šä¸‹æ–‡èœå•

#### ä¿®å¤å†…å®¹
**æ–‡ä»¶**: `ui/widgets/account_widget.py`

```python
# ä¿®å¤å‰ï¼ˆè¢«æ³¨é‡Šæ‰ï¼‰
# self.account_table.setContextMenuPolicy(Qt.CustomContextMenu)
# self.account_table.customContextMenuRequested.connect(self._show_context_menu)

# ä¿®å¤å
# ğŸ†• æ¢å¤å³é”®èœå•è®¾ç½®ï¼Œæ”¯æŒå¢å¼ºçš„å³é”®èœå•åŠŸèƒ½
self.account_table.setContextMenuPolicy(Qt.CustomContextMenu)
self.account_table.customContextMenuRequested.connect(self._show_context_menu)

# ğŸ†• å¢å¼ºçš„å³é”®èœå•å®ç°
def _show_context_menu(self, position):
    menu = QMenu(self)
    
    # è®¾ç½®ä¸ºä¸»è´¦å·
    set_main_action = menu.addAction("è®¾ç½®ä¸ºä¸»è´¦å·")
    set_main_action.triggered.connect(lambda: self._set_as_main_account(account_data))
    
    # è®¾ç½®æ”¯ä»˜å¯†ç 
    set_password_action = menu.addAction("è®¾ç½®æ”¯ä»˜å¯†ç ")
    set_password_action.triggered.connect(lambda: self._set_payment_password(account_data))
    
    # åˆ é™¤è´¦å·
    delete_action = menu.addAction("åˆ é™¤è´¦å·")
    delete_action.triggered.connect(lambda: self._delete_account(account_data))
    
    menu.exec_(self.account_table.mapToGlobal(position))
```

#### ä¿®å¤æ•ˆæœ
- âœ… å³é”®ç‚¹å‡»è´¦å·æ˜¾ç¤ºå®Œæ•´èœå•
- âœ… æ”¯æŒè®¾ç½®ä¸»è´¦å·ã€æ”¯ä»˜å¯†ç ã€åˆ é™¤è´¦å·
- âœ… æ‰€æœ‰æ“ä½œéƒ½æœ‰ç¡®è®¤å¯¹è¯æ¡†å’Œé”™è¯¯å¤„ç†

## ğŸ¯ ä¿®å¤éªŒè¯

### ç‰¹å®šè®¢å•æµ‹è¯•
**è®¢å•å·**: 202506061158566613245  
**å½±é™¢**: åå¤ä¼˜åŠ èŸå¤§éƒ½èŸ

**ä¿®å¤åçš„æ˜¾ç¤ºæ•ˆæœ**:
```
å½±é™¢: åå¤ä¼˜åŠ èŸå¤§éƒ½èŸ
çŠ¶æ€: å¾…æ”¯ä»˜
å¯†ç : éœ€è¦è¾“å…¥          â† æ–°å¢æ˜¾ç¤º
å®ä»˜é‡‘é¢: Â¥25.00 (ä¼šå‘˜ä»·)  â† ä¿®å¤æ˜¾ç¤º
```

### å®Œæ•´å·¥ä½œæµç¨‹éªŒè¯
1. **é€‰æ‹©å½±é™¢å’Œåœºæ¬¡** â†’ æ­£å¸¸é€‰æ‹©
2. **åˆ›å»ºè®¢å•** â†’ è‡ªåŠ¨è·å–ä¼šå‘˜ä»·æ ¼å’Œå¯†ç ç­–ç•¥
3. **æŸ¥çœ‹è®¢å•è¯¦æƒ…** â†’ æ˜¾ç¤ºä¼šå‘˜ä»·å’Œå¯†ç è¦æ±‚
4. **å³é”®ç®¡ç†è´¦å·** â†’ è®¾ç½®ä¸»è´¦å·ã€æ”¯ä»˜å¯†ç ã€åˆ é™¤è´¦å·
5. **æ”¯ä»˜è®¢å•** â†’ æ ¹æ®ç­–ç•¥æ™ºèƒ½å¤„ç†å¯†ç è¾“å…¥

## ğŸ“Š ç”¨æˆ·ä½“éªŒæå‡

| åŠŸèƒ½ç‚¹ | ä¿®å¤å‰ | ä¿®å¤å |
|--------|--------|--------|
| è´¦å·åŒå‡» | å¼¹å‡ºå¿«é€Ÿç™»å½•æç¤º | æ— ååº”ï¼Œç•Œé¢ç®€æ´ |
| ä»·æ ¼æ˜¾ç¤º | æ˜¾ç¤ºåŸä»· Â¥33.90 | æ˜¾ç¤ºä¼šå‘˜ä»· Â¥25.00 |
| å¯†ç ç­–ç•¥ | ä¸æ˜¾ç¤ºå¯†ç è¦æ±‚ | æ˜ç¡®æ˜¾ç¤º"å¯†ç : éœ€è¦è¾“å…¥" |
| å³é”®èœå• | æ— å“åº” | å®Œæ•´çš„ä¸Šä¸‹æ–‡èœå• |

## ğŸ”— ä¸ä¼šå‘˜å¡å¯†ç ç­–ç•¥çš„é›†æˆ

### é›†æˆè¦ç‚¹
1. **å¯†ç ç­–ç•¥ä¸€è‡´æ€§**: è®¢å•è¯¦æƒ…æ˜¾ç¤ºçš„å¯†ç ç­–ç•¥ä¸æ”¯ä»˜æ—¶æ£€æµ‹ä¿æŒä¸€è‡´
2. **é¢„è®¾å¯†ç åŠŸèƒ½**: æ”¯æŒé€šè¿‡å³é”®èœå•é¢„è®¾è´¦å·æ”¯ä»˜å¯†ç 
3. **æ™ºèƒ½æ”¯ä»˜æµç¨‹**: æ ¹æ®ç­–ç•¥è‡ªåŠ¨å†³å®šæ˜¯å¦éœ€è¦å¯†ç è¾“å…¥
4. **å®Œæ•´é”™è¯¯å¤„ç†**: æ‰€æœ‰æ“ä½œéƒ½æœ‰å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶

### æŠ€æœ¯å®ç°
- **æ•°æ®æºç»Ÿä¸€**: éƒ½åŸºäºè®¢å•è¯¦æƒ…APIçš„ `enable_mempassword` å­—æ®µ
- **çŠ¶æ€åŒæ­¥**: å¯†ç ç­–ç•¥çŠ¶æ€åœ¨å„ä¸ªç»„ä»¶é—´ä¿æŒåŒæ­¥
- **ç”¨æˆ·ä½“éªŒ**: æä¾›é€æ˜ã€ä¸€è‡´çš„ç”¨æˆ·äº¤äº’ä½“éªŒ

## ğŸ‰ ä¿®å¤æ€»ç»“

### ä¿®å¤æˆæœ
- âœ… **é—®é¢˜1**: å¿«é€Ÿç™»å½•åŠŸèƒ½å·²å®Œå…¨ç§»é™¤
- âœ… **é—®é¢˜2**: ä¼šå‘˜ä»·æ˜¾ç¤ºå·²ä¿®å¤ï¼Œä¼˜å…ˆæ˜¾ç¤ºä¼šå‘˜ä¼˜æƒ ä»·
- âœ… **é—®é¢˜3**: å¯†ç ç­–ç•¥æ˜¾ç¤ºå·²ä¿®å¤ï¼Œæ”¯æŒå¤šæ•°æ®æºè·å–
- âœ… **é—®é¢˜4**: è´¦å·å³é”®èœå•å·²ä¿®å¤ï¼ŒåŠŸèƒ½å®Œæ•´å¯ç”¨

### æŠ€æœ¯ä»·å€¼
- **ä»£ç è´¨é‡**: ç§»é™¤äº†ä¸å¿…è¦çš„åŠŸèƒ½ï¼Œä»£ç æ›´åŠ ç®€æ´
- **æ•°æ®å‡†ç¡®æ€§**: ä»·æ ¼å’Œç­–ç•¥æ˜¾ç¤ºæ›´åŠ å‡†ç¡®
- **ç”¨æˆ·ä½“éªŒ**: ç•Œé¢æ›´åŠ ä¸“ä¸šï¼Œæ“ä½œæ›´åŠ ä¾¿æ·
- **åŠŸèƒ½å®Œæ•´æ€§**: è´¦å·ç®¡ç†åŠŸèƒ½æ›´åŠ å®Œå–„

### ä¸šåŠ¡ä»·å€¼
- **æå‡æ•ˆç‡**: ç”¨æˆ·å¯ä»¥å¿«é€Ÿäº†è§£ä»·æ ¼å’Œå¯†ç è¦æ±‚
- **é™ä½å›°æƒ‘**: æ˜ç¡®çš„ç­–ç•¥æ˜¾ç¤ºå‡å°‘ç”¨æˆ·ç–‘æƒ‘
- **å¢å¼ºä¾¿æ·æ€§**: å³é”®èœå•æä¾›å¿«é€Ÿçš„è´¦å·ç®¡ç†
- **æ”¹å–„ä½“éªŒ**: æ•´ä½“ç”¨æˆ·ä½“éªŒå¾—åˆ°æ˜¾è‘—æå‡

è¿™äº›ä¿®å¤ä¸ä»…è§£å†³äº†å…·ä½“çš„æŠ€æœ¯é—®é¢˜ï¼Œæ›´é‡è¦çš„æ˜¯æå‡äº†æ•´ä½“çš„ç”¨æˆ·ä½“éªŒï¼Œä¸ºå½±é™¢ç¥¨åŠ¡ç³»ç»Ÿçš„ç°ä»£åŒ–å’Œä¸“ä¸šåŒ–åšå‡ºäº†é‡è¦è´¡çŒ®ã€‚
