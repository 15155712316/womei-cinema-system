{
  "timestamp": "2025-05-29T11:45:33.491406",
  "total_tests": 9,
  "passed_tests": 8,
  "success_rate": 88.88888888888889,
  "results": {
    "service_status": {
      "status": "PASS",
      "response": {
        "endpoints": [
          "/login",
          "/set_points",
          "/set_status",
          "/update_machine_code",
          "/update_user_points",
          "/toggle_user_status",
          "/admin"
        ],
        "features": "完整机器码管理功能",
        "service": "乐影系统API服务器",
        "status": "运行中",
        "version": "1.2"
      }
    },
    "health_check": {
      "status": "PASS",
      "response": {
        "database": "connected",
        "status": "healthy"
      }
    },
    "admin_page": {
      "status": "PASS",
      "response": "\n<!DOCTYPE html>\n<html>\n<head>\n    <title>乐影系统 - 管理后台</title>\n    <meta charset=\"utf-8\">\n    <style>\n        body { font-family: 'Microsoft YaHei', Arial, sans-serif; margin: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }\n        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }\n        .header { text-align: center; color: white; margin-bottom: 30px; }\n        .header h1 { font-size: 2.5em; margin: 0; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }\n        .header p { font-size: 1.2em; margin: 10px 0; opacity: 0.9; }\n        .main-content { background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); overflow: hidden; }\n        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; padding: 30px; background: #f8f9fa; }\n        .stat-card { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 25px; border-radius: 12px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }\n        .stat-card h3 { font-size: 2.5em; margin: 0; font-weight: bold; }\n        .stat-card p { margin: 10px 0 0; font-size: 1.1em; opacity: 0.9; }\n        .feature-section { padding: 30px; border-bottom: 1px solid #eee; }\n        .feature-section h3 { color: #333; margin-bottom: 20px; font-size: 1.4em; }\n        .form-row { display: flex; gap: 15px; align-items: end; flex-wrap: wrap; }\n        .form-group { flex: 1; min-width: 150px; }\n        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #555; }\n        .form-group input, .form-group select { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; transition: border-color 0.3s; }\n        .form-group input:focus, .form-group select:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }\n        .btn { padding: 12px 24px; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s; text-decoration: none; display: inline-block; }\n        .btn-primary { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }\n        .btn-success { background: linear-gradient(135deg, #56ab2f, #a8e6cf); color: white; }\n        .btn-warning { background: linear-gradient(135deg, #f093fb, #f5576c); color: white; }\n        .btn-danger { background: linear-gradient(135deg, #fc466b, #3f5efb); color: white; }\n        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }\n        .machine-code-section { background: linear-gradient(135deg, #a8edea, #fed6e3); }\n        .machine-code-section .current-code { background: rgba(0,0,0,0.1); padding: 15px; border-radius: 8px; margin-top: 15px; font-family: 'Courier New', monospace; }\n        .table-container { padding: 30px; }\n        table { width: 100%; border-collapse: collapse; border-radius: 8px; overflow: hidden; box-shadow: 0 0 20px rgba(0,0,0,0.1); }\n        th { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 15px; text-align: left; font-weight: 600; }\n        td { padding: 15px; border-bottom: 1px solid #eee; }\n        tr:hover { background: #f8f9fa; }\n        .status-enabled { color: #28a745; font-weight: bold; }\n        .status-disabled { color: #dc3545; font-weight: bold; }\n        .machine-code { font-family: 'Courier New', monospace; font-size: 12px; background: #f1f3f4; padding: 4px 8px; border-radius: 4px; }\n        .btn-group { display: flex; gap: 5px; flex-wrap: wrap; }\n        .btn-sm { padding: 6px 12px; font-size: 12px; }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"header\">\n            <h1>🎬 乐影系统管理后台</h1>\n            <p>版本 1.2 | 完整机器码管理功能</p>\n        </div>\n        \n        <div class=\"main-content\">\n            <div class=\"stats\">\n                <div class=\"stat-card\">\n                    <h3>1</h3>\n                    <p>总用户数</p>\n                </div>\n                <div class=\"stat-card\">\n                    <h3>1</h3>\n                    <p>启用用户</p>\n                </div>\n                <div class=\"stat-card\">\n                    <h3>0</h3>\n                    <p>禁用用户</p>\n                </div>\n                <div class=\"stat-card\">\n                    <h3>1</h3>\n                    <p>已绑定设备</p>\n                </div>\n            </div>\n            \n            <div class=\"feature-section machine-code-section\">\n                <h3>🔧 机器码管理</h3>\n                <form onsubmit=\"updateMachineCode(event)\">\n                    <div class=\"form-row\">\n                        <div class=\"form-group\">\n                            <label>手机号</label>\n                            <input type=\"text\" id=\"machinePhone\" placeholder=\"输入手机号\" required>\n                        </div>\n                        <div class=\"form-group\">\n                            <label>新机器码</label>\n                            <input type=\"text\" id=\"newMachineCode\" placeholder=\"输入新机器码\" required>\n                        </div>\n                        <div class=\"form-group\">\n                            <button type=\"submit\" class=\"btn btn-success\">更新机器码</button>\n                        </div>\n                    </div>\n                </form>\n                <div class=\"current-code\">\n                    <strong>💡 当前设备真实机器码：</strong><br>\n                    <code>9DC6B72833DBFDA6</code><br>\n                    <small>点击右侧按钮可快速填入当前机器码</small>\n                    <button onclick=\"fillCurrentMachineCode()\" class=\"btn btn-warning btn-sm\" style=\"margin-left: 10px;\">使用当前机器码</button>\n                </div>\n            </div>\n            \n            <div class=\"feature-section\">\n                <h3>➕ 添加新用户</h3>\n                <form onsubmit=\"addUser(event)\">\n                    <div class=\"form-row\">\n                        <div class=\"form-group\">\n                            <label>手机号</label>\n                            <input type=\"text\" id=\"phone\" placeholder=\"输入手机号\" required>\n                        </div>\n                        <div class=\"form-group\">\n                            <label>初始积分</label>\n                            <input type=\"number\" id=\"points\" placeholder=\"0\" value=\"0\">\n                        </div>\n                        <div class=\"form-group\">\n                            <label>账号状态</label>\n                            <select id=\"status\">\n                                <option value=\"1\">启用</option>\n                                <option value=\"0\">禁用</option>\n                            </select>\n                        </div>\n                        <div class=\"form-group\">\n                            <button type=\"submit\" class=\"btn btn-primary\">添加用户</button>\n                        </div>\n                    </div>\n                </form>\n            </div>\n            \n            <div class=\"table-container\">\n                <h3>👥 用户管理</h3>\n                <table>\n                    <thead>\n                        <tr>\n                            <th>手机号</th>\n                            <th>积分</th>\n                            <th>状态</th>\n                            <th>机器码</th>\n                            <th>创建时间</th>\n                            <th>操作</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        \n                        <tr>\n                            <td><strong>15155712316</strong></td>\n                            <td>800</td>\n                            <td class=\"status-enabled\">\n                                ✅ 启用\n                            </td>\n                            <td>\n                                \n                                    <span class=\"machine-code\" title=\"9DC6B72833DBFDA6\">9DC6B72833DBFDA6</span>\n                                \n                            </td>\n                            <td>2025-05-28 23:02</td>\n                            <td>\n                                <div class=\"btn-group\">\n                                    <button onclick=\"editPoints('15155712316')\" class=\"btn btn-primary btn-sm\">改积分</button>\n                                    <button onclick=\"editMachineCode('15155712316')\" class=\"btn btn-warning btn-sm\">改机器码</button>\n                                    <button onclick=\"toggleStatus('15155712316', 1)\" class=\"btn btn-success btn-sm\">\n                                        禁用\n                                    </button>\n                                    <button onclick=\"deleteUser('15155712316')\" class=\"btn btn-danger btn-sm\">删除</button>\n                                </div>\n                            </td>\n                        </tr>\n                        \n                    </tbody>\n                </table>\n            </div>\n        </div>\n    </div>\n    \n    <script>\n        function showMessage(message, isSuccess = true) {\n            const alertType = isSuccess ? 'success' : 'error';\n            alert(`${isSuccess ? '✅' : '❌'} ${message}`);\n        }\n        \n        function fillCurrentMachineCode() {\n            document.getElementById('newMachineCode').value = '9DC6B72833DBFDA6';\n        }\n        \n        function updateMachineCode(event) {\n            event.preventDefault();\n            const phone = document.getElementById('machinePhone').value;\n            const machineCode = document.getElementById('newMachineCode').value;\n            \n            fetch('/update_machine_code', {\n                method: 'POST',\n                headers: {'Content-Type': 'application/json'},\n                body: JSON.stringify({phone, machineCode})\n            })\n            .then(response => response.json())\n            .then(data => {\n                showMessage(data.message, data.success);\n                if (data.success) {\n                    setTimeout(() => location.reload(), 1000);\n                }\n            })\n            .catch(error => showMessage('请求失败: ' + error, false));\n        }\n        \n        function addUser(event) {\n            event.preventDefault();\n            const phone = document.getElementById('phone').value;\n            const points = document.getElementById('points').value;\n            const status = document.getElementById('status').value;\n            \n            fetch('/admin/add_user', {\n                method: 'POST',\n                headers: {'Content-Type': 'application/json'},\n                body: JSON.stringify({phone, points: parseInt(points), status: parseInt(status)})\n            })\n            .then(response => response.json())\n            .then(data => {\n                showMessage(data.message, data.success);\n                if (data.success) {\n                    setTimeout(() => location.reload(), 1000);\n                }\n            })\n            .catch(error => showMessage('请求失败: ' + error, false));\n        }\n        \n        function editPoints(phone) {\n            const points = prompt('请输入新积分:');\n            if (points !== null && !isNaN(points)) {\n                fetch('/set_points', {\n                    method: 'POST',\n                    headers: {'Content-Type': 'application/json'},\n                    body: JSON.stringify({phone, points: parseInt(points)})\n                })\n                .then(response => response.json())\n                .then(data => {\n                    showMessage(data.success ? '积分更新成功' : data.message, data.success);\n                    if (data.success) setTimeout(() => location.reload(), 1000);\n                });\n            }\n        }\n        \n        function editMachineCode(phone) {\n            const machineCode = prompt('请输入新机器码\\n\\n提示：当前设备机器码为 9DC6B72833DBFDA6');\n            if (machineCode !== null && machineCode.trim() !== '') {\n                fetch('/update_machine_code', {\n                    method: 'POST',\n                    headers: {'Content-Type': 'application/json'},\n                    body: JSON.stringify({phone, machineCode: machineCode.trim()})\n                })\n                .then(response => response.json())\n                .then(data => {\n                    showMessage(data.message, data.success);\n                    if (data.success) setTimeout(() => location.reload(), 1000);\n                });\n            }\n        }\n        \n        function toggleStatus(phone, currentStatus) {\n            const newStatus = currentStatus === 1 ? 0 : 1;\n            const action = newStatus === 1 ? '启用' : '禁用';\n            \n            if (confirm(`确认${action}用户 ${phone}?`)) {\n                fetch('/set_status', {\n                    method: 'POST',\n                    headers: {'Content-Type': 'application/json'},\n                    body: JSON.stringify({phone, status: newStatus})\n                })\n                .then(response => response.json())\n                .then(data => {\n                    showMessage(data.success ? `用户已${action}` : data.message, data.success);\n                    if (data.success) setTimeout(() => location.reload(), 1000);\n                });\n            }\n        }\n        \n        function deleteUser(phone) {\n            if (confirm('确认删除用户 ' + phone + '?\\n\\n⚠️ 此操作不可恢复！')) {\n                fetch('/admin/delete_user', {\n                    method: 'POST',\n                    headers: {'Content-Type': 'application/json'},\n                    body: JSON.stringify({phone})\n                })\n                .then(response => response.json())\n                .then(data => {\n                    showMessage(data.message, data.success);\n                    if (data.success) setTimeout(() => location.reload(), 1000);\n                });\n            }\n        }\n    </script>\n</body>\n</html>\n        "
    },
    "update_machine_code": {
      "status": "PASS",
      "response": {
        "data": {
          "machineCode": "9DC6B72833DBFDA6",
          "phone": "15155712316",
          "updateTime": "2025-05-29 11:45:33"
        },
        "message": "机器码更新成功",
        "success": true
      }
    },
    "update_user_points": {
      "status": "PASS",
      "response": {
        "data": {
          "phone": "15155712316",
          "points": 1500,
          "updateTime": "2025-05-29 11:45:33"
        },
        "message": "积分更新成功",
        "success": true
      }
    },
    "toggle_user_status": {
      "status": "PASS",
      "response": {
        "data": {
          "phone": "15155712316",
          "status": 0,
          "statusText": "禁用",
          "updateTime": "2025-05-29 11:45:33"
        },
        "message": "用户状态已禁用",
        "success": true
      }
    },
    "login_real_machine_code": {
      "status": "FAIL",
      "error": "Status: 403"
    },
    "set_points": {
      "status": "PASS",
      "response": {
        "points": 888,
        "success": true
      }
    },
    "set_status": {
      "status": "PASS",
      "response": {
        "status": 1,
        "success": true
      }
    }
  }
}